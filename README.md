Sirius Contest Events Bot
=========================

Telegram-бот, который может записывать пользователей на мероприятия,
проходящие на [Федеральной территории Сириус](https://sirius-ft.ru/).

Мой бот: [@s4_siriusContestEventsBot](https://t.me/s4_siriusContestEventsBot)

Возможности
-----------
- Создание и редактирование мероприятий через telegram-бота
- Получение списка актуальных мероприятий 
  (актуальными считаются мероприятия, дата и время которых больше текущей даты)
- Получение полного списка мероприятий.
- Регистрация на мероприятие 
  (создание уникального билета на мероприятие для заданного количества людей)
- Получение списка актуальных билетов 
  (актуальными считаются билеты, 
  дата и время которых больше текущего времени вчерашнего дня)
- Получение QR-кода с данными билета, 
  присылаемого telegram-ботом в виде изображения.
  
Использование
-------------
### Установка и запуск
1. Установите [Python 3.9.6](https://www.python.org/downloads/) 
   (на 2.x работать точно не будет, 
   работоспособность на более ранних 3.x версиях не проверялась).

2. Скачайте исходный код проекта с 
   [GitHub](https://github.com/Shuta4/siriusContestEventsBot).

2. Установите необходимые зависимости:
```bash
cd path/to/project
pip install -r requirements.txt
```

3. Укажите переменные окружения, необходимые для запуска 
   ([Настройка](#настройка)).
   
4. Запустите бота командой:
```bash
python events_bot/main.py
```

### Настройка
Бот настраивается с помощью следующих переменных окружения:

```bash
# Telegram Bot Token
# Вы можете получить его через telegram-бота @BotFather
export EVENTS_BOT_TOKEN=""

# Путь к файлу базы данных (SQLite),
# если файла нет, автоматически создается новый файл с базой данных.
# Значение ":memory:", используемое SQLite для создания базы данных в
# оперативной памяти, работать не будет.
export EVENTS_BOT_DB=""

# [Необязательная переменная]
# Разделенные ':' идентификаторы telegram-пользователей, 
# которым нужно предоставить права администратора 
# (создание, редактирование мероприятий).
# Чтобы узнать свой идентификатор, напишите telegram-боту @my_id_bot
export EVENTS_BOT_ADMIN_USERS=""
```

Техническая информация
----------------------
### Основной стек технологий:
- [Python](https://www.python.org/) (связывающий все воедино)
- [SQLite](https://www.sqlite.org/) (база данных)
- [pyTelegramBotAPI](https://github.com/eternnoir/pyTelegramBotAPI) 
  (python-библиотека для взаимодействия с 
  [Telegram Bot API](https://core.telegram.org/bots/api))
- [QRCode](https://github.com/lincolnloop/python-qrcode) 
  (python-библиотека для генерации qr-кодов)
  
### QR-коды
Генерируемые QR-коды имеют вид стандартного URI со схемой 'ticket'.
Пример зашифрованного в QR-коде значения:
```
ticket://07b93ae1-b126-4c89-b986-2244c41fe2cf?datetime=2021-07-29T13:30:00&name=IT-%EA%EE%ED%F4%E5%F0%E5%ED%F6%E8%FF&members=16
Расшифровка URI:
   ticket://[Уникальный идентификатор билета в базе данных бота]
   ?datetime=[Дата и время мероприятия в ISO-формате]
   &name=[Название мероприятия, недопустимые в URI символы закодированы]
   &members=[Кол-во участников, на которое брался билет]
```